<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>p5.js Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
  </head>
  <body>
    <script>
      const elements = [];

      function setup() {
        createCanvas(400, 400);
      }

      function draw() {
        background(220);
        fill(255, 0, 0);

        elements.forEach((element) => {
          if (element.elementType === "circle") {
            circle(element.x, element.y, element.r);
          } else if (element.elementType === "line") {
            line(element.x1, element.y1, element.x2, element.y2);
          }
        });
      }

      // create a websocket client
      // the commands that the client can receive are:
      // - add: { "command": "add-element", "payload": { "elementType": "circle", "x": 10, "y": 30, "r": 10 } } - the client should return the index of the element
      // - remove: { "command": "remove-element", "payload": { "index": 0 } }
      // - update: { "command": "update-element", "payload": { "index": 0, "x": 10, "y": 40, "r": 20 } }

      const ws = new WebSocket("ws://localhost:1234");

      ws.onopen = () => {
        console.log("connected");
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.command === "add-element") {
          elements.push(data.payload);
        } else if (data.command === "remove-element") {
          elements.splice(data.payload.index, 1);
        } else if (data.command === "update-element") {
          const element = elements[data.payload.index];
          element.x = data.payload.x;
          element.y = data.payload.y;
          element.r = data.payload.r;
        }
      };
    </script>
  </body>
</html>
